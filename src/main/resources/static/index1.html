<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>学生选课管理系统 - 炫酷版</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6c5ce7; /* A modern purple */
            --secondary-color: #fd79a8; /* A soft pink */
            --accent-color: #00cec9; /* A vibrant teal */
            --background-start: #2c3e50;
            --background-end: #3498db;
            --text-color: #ecf0f1;
            --card-background: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--background-start), var(--background-end));
            background-attachment: fixed;
            color: var(--text-color);
            padding-top: 20px;
            padding-bottom: 20px;
            overflow-x: hidden; /* Prevent horizontal scroll from decorative elements */
        }

        /* Decorative background elements */
        body::before, body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            opacity: 0.15;
            z-index: -1;
            animation: pulseBubble 15s infinite ease-in-out;
        }

        body::before {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--primary-color), transparent 60%);
            top: 5%;
            left: -50px;
        }

        body::after {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, var(--accent-color), transparent 70%);
            bottom: 5%;
            right: -80px;
            animation-delay: -7.5s;
        }

        @keyframes pulseBubble {
            0%, 100% { transform: scale(0.9) rotate(0deg); opacity: 0.1; }
            50% { transform: scale(1.1) rotate(10deg); opacity: 0.2; }
        }

        .container {
            background-color: var(--card-background);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            margin-top: 20px;
            position: relative; /* For potential pseudo-elements */
            overflow: hidden; /* Clip overflowing decorative elements */
        }

        /* Add a subtle animated border to the container */
        .container::before {
            content: "";
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            z-index: -1;
            margin: -2px; /* Adjust to border thickness */
            border-radius: inherit; /* Follow container's border-radius */
            background: linear-gradient(to right, var(--primary-color), var(--accent-color), var(--secondary-color));
            animation: animatedBorder 5s linear infinite;
            background-size: 200% 200%;
        }

        @keyframes animatedBorder {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }


        h2 {
            color: var(--text-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 300;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color);
            animation: fadeInDown 1s ease-out;
        }

        .nav-tabs {
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .nav-tabs .nav-link {
            color: rgba(255, 255, 255, 0.7);
            border: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            padding: 10px 20px;
            font-weight: 500;
        }

        .nav-tabs .nav-link:hover {
            color: var(--text-color);
            border-bottom-color: var(--accent-color);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-tabs .nav-link.active {
            color: var(--text-color);
            background-color: transparent; /* Keep it clean */
            border-bottom: 3px solid var(--primary-color);
            font-weight: 700;
        }

        .btn {
            border-radius: 25px; /* Pill shape */
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: color-mix(in srgb, var(--primary-color) 80%, black);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px color-mix(in srgb, var(--primary-color) 50%, transparent);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        .btn-secondary:hover {
            background-color: color-mix(in srgb, var(--secondary-color) 80%, black);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px color-mix(in srgb, var(--secondary-color) 50%, transparent);
        }

        .btn-warning {
            background-color: #f39c12; /* Bootstrap orange */
            color: white;
        }
        .btn-warning:hover {
            background-color: #e67e22;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }

        .btn-danger {
            background-color: #e74c3c; /* Bootstrap red */
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .btn-success {
            background-color: var(--accent-color);
            color: white;
        }
        .btn-success:hover {
            background-color: color-mix(in srgb, var(--accent-color) 80%, black);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px color-mix(in srgb, var(--accent-color) 50%, transparent);
        }


        .table {
            background-color: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            overflow: hidden; /* For rounded corners on table */
            color: var(--text-color);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .table th, .table td {
            border-color: var(--border-color) !important; /* Override Bootstrap */
            vertical-align: middle;
        }

        .table thead th {
            background-color: rgba(0,0,0,0.2);
            color: var(--text-color);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tbody tr {
            transition: background-color 0.3s ease, transform 0.2s ease;
            animation: fadeInRow 0.5s ease-out forwards;
            opacity: 0;
        }

        .table tbody tr:nth-child(odd) {
            background-color: rgba(255,255,255,0.03);
        }
        .table tbody tr:nth-child(even) {
            background-color: rgba(255,255,255,0.06);
        }

        .table tbody tr:hover {
            background-color: rgba(var(--primary-color-rgb), 0.3); /* Use RGB for opacity */
            transform: scale(1.01);
            box-shadow: 0 0 15px rgba(var(--primary-color-rgb), 0.5);
            z-index: 1;
            position: relative;
        }

        /* Staggered animation for table rows */
        .table tbody tr:nth-child(1) { animation-delay: 0.05s; }
        .table tbody tr:nth-child(2) { animation-delay: 0.1s; }
        .table tbody tr:nth-child(3) { animation-delay: 0.15s; }
        .table tbody tr:nth-child(4) { animation-delay: 0.2s; }
        .table tbody tr:nth-child(5) { animation-delay: 0.25s; }
        /* Add more if needed or handle dynamically with JS if tables are very long */


        .modal-content {
            background-color: #2c3e50; /* Darker background for modals */
            border-radius: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            color: var(--text-color);
            animation: zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-header {
            border-bottom: 1px solid var(--border-color);
        }
        .modal-header .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%); /* Make close button white */
        }

        .modal-title {
            color: var(--primary-color);
            font-weight: 600;
        }

        .modal-footer {
            border-top: 1px solid var(--border-color);
        }

        .form-label {
            color: var(--accent-color);
            font-weight: 500;
        }

        .form-control {
            background-color: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 8px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-control:focus {
            background-color: rgba(255,255,255,0.15);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem color-mix(in srgb, var(--primary-color) 30%, transparent);
            color: var(--text-color);
        }
        .form-control::placeholder {
            color: rgba(255,255,255,0.5);
        }

        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInRow {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Tab content animation */
        .tab-pane.fade {
            transition: opacity .3s linear;
        }
        .tab-pane.active.show {
            animation: tabFadeIn 0.5s ease-out;
        }
        @keyframes tabFadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* For color-mix to work with primary-color in table hover */
        :root {
            --primary-color-rgb: 108, 92, 231; /* RGB for var(--primary-color) */
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            h2 {
                font-size: 1.8rem;
            }
            .container {
                padding: 20px;
            }
            body::before, body::after {
                width: 200px;
                height: 200px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h2>学生选课管理系统</h2>

    <!-- 导航栏 -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="student-tab" data-bs-toggle="tab" data-bs-target="#student" type="button" role="tab" aria-controls="student" aria-selected="true">学生管理</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="course-tab" data-bs-toggle="tab" data-bs-target="#course" type="button" role="tab" aria-controls="course" aria-selected="false">课程管理</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="sc-tab" data-bs-toggle="tab" data-bs-target="#sc" type="button" role="tab" aria-controls="sc" aria-selected="false">选课管理</button>
        </li>
    </ul>

    <!-- 内容区域 -->
    <div class="tab-content" id="myTabContent">
        <!-- 学生管理 -->
        <div class="tab-pane fade show active" id="student" role="tabpanel" aria-labelledby="student-tab">
            <div class="row mt-3 mb-3">
                <div class="col">
                    <button class="btn btn-primary" onclick="showAddStudentModal()">添加学生</button>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>学号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>年龄</th>
                        <th>院系</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="studentTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- 课程管理 -->
        <div class="tab-pane fade" id="course" role="tabpanel" aria-labelledby="course-tab">
            <div class="row mt-3 mb-3">
                <div class="col">
                    <button class="btn btn-primary" onclick="showAddCourseModal()">添加课程</button>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>课程号</th>
                        <th>课程名</th>
                        <th>先修课程</th>
                        <th>学分</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="courseTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- 选课管理 -->
        <div class="tab-pane fade" id="sc" role="tabpanel" aria-labelledby="sc-tab">
            <div class="row mt-3 mb-3">
                <div class="col">
                    <button class="btn btn-primary" onclick="showAddSCModal()">添加选课</button>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>学号</th>
                        <th>课程号</th>
                        <th>成绩</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="scTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 添加学生模态框 -->
<div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addStudentModalLabel">添加学生</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addStudentForm">
                    <div class="mb-3">
                        <label for="snoAdd" class="form-label">学号</label>
                        <input type="text" class="form-control" id="snoAdd" name="sno" required>
                    </div>
                    <div class="mb-3">
                        <label for="snameAdd" class="form-label">姓名</label>
                        <input type="text" class="form-control" id="snameAdd" name="sname" required>
                    </div>
                    <div class="mb-3">
                        <label for="sgenderAdd" class="form-label">性别</label>
                        <input type="text" class="form-control" id="sgenderAdd" name="sgender" required>
                    </div>
                    <div class="mb-3">
                        <label for="sageAdd" class="form-label">年龄</label>
                        <input type="number" class="form-control" id="sageAdd" name="sage" required>
                    </div>
                    <div class="mb-3">
                        <label for="sdeptAdd" class="form-label">院系</label>
                        <input type="text" class="form-control" id="sdeptAdd" name="sdept" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="addStudent()">确定</button>
            </div>
        </div>
    </div>
</div>

<!-- 添加课程模态框 -->
<div class="modal fade" id="addCourseModal" tabindex="-1" aria-labelledby="addCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCourseModalLabel">添加课程</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addCourseForm">
                    <div class="mb-3">
                        <label for="cnoAdd" class="form-label">课程号</label>
                        <input type="text" class="form-control" id="cnoAdd" name="cno" required>
                    </div>
                    <div class="mb-3">
                        <label for="cnameAdd" class="form-label">课程名</label>
                        <input type="text" class="form-control" id="cnameAdd" name="cname" required>
                    </div>
                    <div class="mb-3">
                        <label for="cpnoAdd" class="form-label">先修课程</label>
                        <input type="text" class="form-control" id="cpnoAdd" name="cpno">
                    </div>
                    <div class="mb-3">
                        <label for="ccreditAdd" class="form-label">学分</label>
                        <input type="number" class="form-control" id="ccreditAdd" name="ccredit" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="addCourse()">确定</button>
            </div>
        </div>
    </div>
</div>

<!-- 添加选课模态框 -->
<div class="modal fade" id="addSCModal" tabindex="-1" aria-labelledby="addSCModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addSCModalLabel">添加选课</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addSCForm">
                    <div class="mb-3">
                        <label for="snoScAdd" class="form-label">学号</label>
                        <input type="text" class="form-control" id="snoScAdd" name="sno" required>
                    </div>
                    <div class="mb-3">
                        <label for="cnoScAdd" class="form-label">课程号</label>
                        <input type="text" class="form-control" id="cnoScAdd" name="cno" required>
                    </div>
                    <div class="mb-3">
                        <label for="gradeScAdd" class="form-label">成绩</label>
                        <input type="number" class="form-control" id="gradeScAdd" name="grade" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="addSC()">确定</button>
            </div>
        </div>
    </div>
</div>

<!-- 选课模态框 -->
<div class="modal fade" id="selectCourseModal" tabindex="-1" aria-labelledby="selectCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="selectCourseModalLabel">学生选课</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="studentSnoForSelectCourse">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>课程号</th>
                            <th>课程名</th>
                            <th>先修课程</th>
                            <th>学分</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="availableCoursesTableBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- 退课模态框 -->
<div class="modal fade" id="dropCourseModal" tabindex="-1" aria-labelledby="dropCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dropCourseModalLabel">学生退课</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="studentSnoForDropCourse">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>课程号</th>
                            <th>课程名</th>
                            <th>成绩</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="studentCoursesTableBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑学生信息模态框 -->
<div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editStudentModalLabel">编辑学生信息</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editStudentForm">
                    <div class="mb-3">
                        <label class="form-label">学号</label>
                        <input type="text" class="form-control" name="sno" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">姓名</label>
                        <input type="text" class="form-control" name="sname" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">性别</label>
                        <input type="text" class="form-control" name="sgender" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">年龄</label>
                        <input type="number" class="form-control" name="sage" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">院系</label>
                        <input type="text" class="form-control" name="sdept" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="updateStudent()">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑课程信息模态框 -->
<div class="modal fade" id="editCourseModal" tabindex="-1" aria-labelledby="editCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCourseModalLabel">编辑课程信息</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editCourseForm">
                    <div class="mb-3">
                        <label class="form-label">课程号</label>
                        <input type="text" class="form-control" name="cno" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">课程名</label>
                        <input type="text" class="form-control" name="cname" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">先修课程</label>
                        <input type="text" class="form-control" name="cpno" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">学分</label>
                        <input type="number" class="form-control" name="ccredit" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="updateCourse()">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑选课成绩模态框 -->
<div class="modal fade" id="editSCModal" tabindex="-1" aria-labelledby="editSCModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editSCModalLabel">编辑选课成绩</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editSCForm">
                    <div class="mb-3">
                        <label class="form-label">学号</label>
                        <input type="text" class="form-control" name="sno" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">课程号</label>
                        <input type="text" class="form-control" name="cno" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">成绩</label>
                        <input type="number" class="form-control" name="grade" required min="0" max="100">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="updateSC()">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- 删除学生确认模态框 -->
<div class="modal fade" id="deleteStudentConfirmModal" tabindex="-1" aria-labelledby="deleteStudentConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteStudentConfirmModalLabel">确认删除学生</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>该学生存在以下选课记录，这些记录将被一并删除，是否确认？</p>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>课程号</th>
                            <th>课程名称</th>
                            <th>成绩</th>
                        </tr>
                        </thead>
                        <tbody id="studentCoursesToDeleteTableBody"></tbody>
                    </table>
                </div>
                <input type="hidden" id="studentSnoToDelete">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-danger" onclick="executeDeleteStudent()">确认删除</button>
            </div>
        </div>
    </div>
</div>

<!-- 删除课程确认模态框 -->
<div class="modal fade" id="deleteCourseConfirmModal" tabindex="-1" aria-labelledby="deleteCourseConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteCourseConfirmModalLabel">确认删除课程</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>该课程存在以下选课记录，这些记录将被一并删除，是否确认？</p>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>学号</th>
                            <th>姓名</th>
                            <th>成绩</th>
                        </tr>
                        </thead>
                        <tbody id="courseStudentsToDeleteTableBody"></tbody>
                    </table>
                </div>
                <input type="hidden" id="courseCnoToDelete">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-danger" onclick="executeDeleteCourse()">确认删除</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
<script>
    const API_BASE_URL = 'http://localhost:8080/api';

    let allStudents = []; // 存储所有学生信息

    // 页面加载完成后执行
    $(document).ready(function() {
        // Initialize Bootstrap components like tabs
        var triggerTabList = [].slice.call(document.querySelectorAll('#myTab button'))
        triggerTabList.forEach(function (triggerEl) {
            var tabTrigger = new bootstrap.Tab(triggerEl)

            triggerEl.addEventListener('click', function (event) {
                event.preventDefault()
                tabTrigger.show()
            })
        })

        loadStudents();
        loadCourses();
        loadSCs();
    });

    // 加载学生数据
    function loadStudents() {
        $.get(`${API_BASE_URL}/student`, function(data) {
            const tbody = $('#studentTableBody');
            tbody.empty();
            allStudents = data; // 存储学生数据供后续使用
            data.forEach(student => {
                tbody.append(`
                        <tr>
                            <td>${student.sno}</td>
                            <td>${student.sname}</td>
                            <td>${student.sgender}</td>
                            <td>${student.sage}</td>
                            <td>${student.sdept}</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-1" onclick="showEditStudentModal('${student.sno}')">编辑</button>
                                <button class="btn btn-sm btn-danger me-1" onclick="deleteStudent('${student.sno}')">删除</button>
                                <button class="btn btn-sm btn-primary me-1" onclick="showSelectCourseModal('${student.sno}')">选课</button>
                                <button class="btn btn-sm btn-secondary" onclick="showDropCourseModal('${student.sno}')">退课</button>
                            </td>
                        </tr>
                    `);
            });
        }).fail(function(jqXHR, textStatus, errorThrown) {
            console.error('加载学生数据失败:', textStatus, errorThrown);
            alert('加载学生数据失败，请检查后端服务是否正常运行');
        });
    }

    // 加载课程数据
    function loadCourses() {
        $.get(`${API_BASE_URL}/course`, function(data) {
            const tbody = $('#courseTableBody');
            tbody.empty();
            data.forEach(course => {
                tbody.append(`
                        <tr>
                            <td>${course.cno}</td>
                            <td>${course.cname}</td>
                            <td>${course.cpno || ''}</td>
                            <td>${course.ccredit}</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-1" onclick="showEditCourseModal('${course.cno}')">编辑</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteCourse('${course.cno}')">删除</button>
                            </td>
                        </tr>
                    `);
            });
        }).fail(function(jqXHR, textStatus, errorThrown) {
            console.error('加载课程数据失败:', textStatus, errorThrown);
            alert('加载课程数据失败，请检查后端服务是否正常运行');
        });
    }

    // 加载选课数据
    function loadSCs() {
        $.get(`${API_BASE_URL}/sc`, function(data) {
            const tbody = $('#scTableBody');
            tbody.empty();
            data.forEach(sc => {
                tbody.append(`
                        <tr>
                            <td>${sc.sno}</td>
                            <td>${sc.cno}</td>
                            <td>${sc.grade}</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-1" onclick="showEditSCModal('${sc.sno}', '${sc.cno}')">编辑</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteSC('${sc.sno}', '${sc.cno}')">删除</button>
                            </td>
                        </tr>
                    `);
            });
        }).fail(function(jqXHR, textStatus, errorThrown) {
            console.error('加载选课数据失败:', textStatus, errorThrown);
            alert('加载选课数据失败，请检查后端服务是否正常运行');
        });
    }

    // 显示添加学生模态框
    function showAddStudentModal() {
        $('#addStudentForm')[0].reset();
        new bootstrap.Modal(document.getElementById('addStudentModal')).show();
    }

    // 显示添加课程模态框
    function showAddCourseModal() {
        $('#addCourseForm')[0].reset();
        new bootstrap.Modal(document.getElementById('addCourseModal')).show();
    }

    // 显示添加选课模态框
    function showAddSCModal() {
        $('#addSCForm')[0].reset();
        new bootstrap.Modal(document.getElementById('addSCModal')).show();
    }

    // 添加学生
    function addStudent() {
        const formData = {
            sno: $('#addStudentForm [name="sno"]').val(),
            sname: $('#addStudentForm [name="sname"]').val(),
            sgender: $('#addStudentForm [name="sgender"]').val(),
            sage: parseInt($('#addStudentForm [name="sage"]').val()),
            sdept: $('#addStudentForm [name="sdept"]').val()
        };

        $.ajax({
            url: `${API_BASE_URL}/student`,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function() {
                bootstrap.Modal.getInstance(document.getElementById('addStudentModal')).hide();
                loadStudents();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('添加学生失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 显示选课模态框
    function showSelectCourseModal(sno) {
        $('#studentSnoForSelectCourse').val(sno);

        $.get(`${API_BASE_URL}/sc/student/${sno}`, function(selectedCourses) {
            const selectedCourseIds = selectedCourses.map(sc => sc.cno);

            $.get(`${API_BASE_URL}/course`, function(allCourses) {
                const availableCourses = allCourses.filter(course => {
                    if (selectedCourseIds.includes(course.cno)) {
                        return false;
                    }
                    if (!course.cpno) {
                        return true;
                    }
                    const prerequisiteCourse = selectedCourses.find(sc => sc.cno === course.cpno);
                    return prerequisiteCourse && prerequisiteCourse.grade >= 60;
                });

                const tbody = $('#availableCoursesTableBody');
                tbody.empty();

                if (availableCourses.length === 0) {
                    tbody.append('<tr><td colspan="5" class="text-center">没有可选课程</td></tr>');
                } else {
                    availableCourses.forEach(course => {
                        tbody.append(`
                            <tr>
                                <td>${course.cno}</td>
                                <td>${course.cname}</td>
                                <td>${course.cpno || '无'}</td>
                                <td>${course.ccredit}</td>
                                <td>
                                    <button class="btn btn-sm btn-success" onclick="selectCourse('${sno}', '${course.cno}')">选择</button>
                                </td>
                            </tr>
                        `);
                    });
                }
                new bootstrap.Modal(document.getElementById('selectCourseModal')).show();
            });
        });
    }

    // 选课
    function selectCourse(sno, cno) {
        const formData = {
            sno: sno,
            cno: cno,
            grade: 0
        };

        $.ajax({
            url: `${API_BASE_URL}/sc`,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function() {
                alert('选课成功！');
                bootstrap.Modal.getInstance(document.getElementById('selectCourseModal')).hide();
                loadSCs();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('选课失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 显示退课模态框
    function showDropCourseModal(sno) {
        $('#studentSnoForDropCourse').val(sno);

        $.get(`${API_BASE_URL}/sc/student/${sno}`, function(selectedCourses) {
            $.get(`${API_BASE_URL}/course`, function(allCourses) {
                const studentCourses = selectedCourses.map(sc => {
                    const courseInfo = allCourses.find(c => c.cno === sc.cno) || {};
                    return {
                        ...sc,
                        cname: courseInfo.cname || '未知课程'
                    };
                });

                const tbody = $('#studentCoursesTableBody');
                tbody.empty();

                if (studentCourses.length === 0) {
                    tbody.append('<tr><td colspan="4" class="text-center">没有选课记录</td></tr>');
                } else {
                    studentCourses.forEach(course => {
                        tbody.append(`
                            <tr>
                                <td>${course.cno}</td>
                                <td>${course.cname}</td>
                                <td>${course.grade}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="dropCourse('${sno}', '${course.cno}')">退课</button>
                                </td>
                            </tr>
                        `);
                    });
                }
                new bootstrap.Modal(document.getElementById('dropCourseModal')).show();
            });
        });
    }

    // 退课
    function dropCourse(sno, cno) {
        if (confirm('确定要退选该课程吗？')) {
            $.ajax({
                url: `${API_BASE_URL}/sc/${sno}/${cno}`,
                type: 'DELETE',
                success: function() {
                    const modalElement = document.getElementById('dropCourseModal');
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                    alert('退课成功！');
                    loadSCs();
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    alert('退课失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
                }
            });
        }
    }

    // 显示编辑学生模态框
    function showEditStudentModal(sno) {
        const student = allStudents.find(student => student.sno === sno);
        if (student) {
            $('#editStudentForm [name="sno"]').val(student.sno);
            $('#editStudentForm [name="sname"]').val(student.sname);
            $('#editStudentForm [name="sgender"]').val(student.sgender);
            $('#editStudentForm [name="sage"]').val(student.sage);
            $('#editStudentForm [name="sdept"]').val(student.sdept);

            const modalElement = document.getElementById('editStudentModal');
            if (modalElement) {
                new bootstrap.Modal(modalElement).show();
            }
        } else {
            alert("找不到该学生信息，请刷新页面后重试");
        }
    }

    // 更新学生信息
    function updateStudent() {
        const formData = {
            sno: $('#editStudentForm [name="sno"]').val(),
            sname: $('#editStudentForm [name="sname"]').val(),
            sgender: $('#editStudentForm [name="sgender"]').val(),
            sage: parseInt($('#editStudentForm [name="sage"]').val()),
            sdept: $('#editStudentForm [name="sdept"]').val()
        };

        $.ajax({
            url: `${API_BASE_URL}/student/${formData.sno}`,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function() {
                alert('更新成功！');
                bootstrap.Modal.getInstance(document.getElementById('editStudentModal')).hide();
                loadStudents();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('更新学生信息失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 显示编辑课程模态框
    function showEditCourseModal(cno) {
        $.get(`${API_BASE_URL}/course/${cno}`, function(course) {
            $('#editCourseForm [name="cno"]').val(course.cno);
            $('#editCourseForm [name="cname"]').val(course.cname);
            $('#editCourseForm [name="cpno"]').val(course.cpno || '');
            $('#editCourseForm [name="ccredit"]').val(course.ccredit);
            new bootstrap.Modal(document.getElementById('editCourseModal')).show();
        });
    }

    // 更新课程信息
    function updateCourse() {
        const formData = {
            cno: $('#editCourseForm [name="cno"]').val(),
            cname: $('#editCourseForm [name="cname"]').val(),
            cpno: $('#editCourseForm [name="cpno"]').val() || null,
            ccredit: parseInt($('#editCourseForm [name="ccredit"]').val())
        };

        $.ajax({
            url: `${API_BASE_URL}/course/${formData.cno}`,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function() {
                alert('更新成功！');
                bootstrap.Modal.getInstance(document.getElementById('editCourseModal')).hide();
                loadCourses();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('更新课程信息失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 显示编辑选课成绩模态框
    function showEditSCModal(sno, cno) {
        $.get(`${API_BASE_URL}/sc/student/${sno}`, function(scList) {
            const sc = scList.find(item => item.cno === cno);
            if (sc) {
                $('#editSCForm [name="sno"]').val(sc.sno);
                $('#editSCForm [name="cno"]').val(sc.cno);
                $('#editSCForm [name="grade"]').val(sc.grade);
                new bootstrap.Modal(document.getElementById('editSCModal')).show();
            } else {
                alert('未找到选课记录');
            }
        });
    }

    // 更新选课成绩
    function updateSC() {
        const formData = {
            sno: $('#editSCForm [name="sno"]').val(),
            cno: $('#editSCForm [name="cno"]').val(),
            grade: parseInt($('#editSCForm [name="grade"]').val())
        };

        $.ajax({
            url: `${API_BASE_URL}/sc`,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function() {
                alert('更新成功！');
                bootstrap.Modal.getInstance(document.getElementById('editSCModal')).hide();
                loadSCs();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('更新选课成绩失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 添加课程
    function addCourse() {
        const formData = {
            cno: $('#addCourseForm [name="cno"]').val(),
            cname: $('#addCourseForm [name="cname"]').val(),
            cpno: $('#addCourseForm [name="cpno"]').val() || null,
            ccredit: parseInt($('#addCourseForm [name="ccredit"]').val())
        };

        $.ajax({
            url: `${API_BASE_URL}/course`,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function() {
                alert('添加课程成功！');
                bootstrap.Modal.getInstance(document.getElementById('addCourseModal')).hide();
                loadCourses();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('添加课程失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 添加选课
    function addSC() {
        const formData = {
            sno: $('#addSCForm [name="sno"]').val(),
            cno: $('#addSCForm [name="cno"]').val(),
            grade: parseInt($('#addSCForm [name="grade"]').val())
        };

        $.ajax({
            url: `${API_BASE_URL}/sc`,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function() {
                alert('添加选课成功！');
                bootstrap.Modal.getInstance(document.getElementById('addSCModal')).hide();
                loadSCs();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('添加选课失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 删除学生
    function deleteStudent(sno) {
        $.get(`${API_BASE_URL}/sc/student/${sno}`, function(data) {
            if (data && data.length > 0) {
                $.get(`${API_BASE_URL}/course`, function(allCourses) {
                    const studentCourses = data.map(sc => {
                        const courseInfo = allCourses.find(c => c.cno === sc.cno) || {};
                        return { ...sc, cname: courseInfo.cname || '未知课程' };
                    });

                    const tbody = $('#studentCoursesToDeleteTableBody');
                    tbody.empty();
                    studentCourses.forEach(course => {
                        tbody.append(`
                            <tr>
                                <td>${course.cno}</td>
                                <td>${course.cname}</td>
                                <td>${course.grade}</td>
                            </tr>`);
                    });
                    $('#studentSnoToDelete').val(sno);
                    new bootstrap.Modal(document.getElementById('deleteStudentConfirmModal')).show();
                });
            } else {
                if(confirm('确定要删除这个学生吗？')) {
                    executeDeleteStudent(sno);
                }
            }
        }).fail(function() {
            if(confirm('确定要删除这个学生吗？')) {
                executeDeleteStudent(sno);
            }
        });
    }

    // 执行删除学生操作
    function executeDeleteStudent(sno) {
        if (!sno) sno = $('#studentSnoToDelete').val();

        $.ajax({
            url: `${API_BASE_URL}/sc/student/${sno}`,
            type: 'DELETE',
            success: function() {
                $.ajax({
                    url: `${API_BASE_URL}/student/${sno}`,
                    type: 'DELETE',
                    success: function() {
                        const modalElement = document.getElementById('deleteStudentConfirmModal');
                        const modal = bootstrap.Modal.getInstance(modalElement);
                        if (modal) modal.hide();
                        loadStudents();
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert('删除学生失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
                    }
                });
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('删除学生选课记录失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 删除课程
    function deleteCourse(cno) {
        $.get(`${API_BASE_URL}/sc/course/${cno}`, function(data) {
            if (data && data.length > 0) {
                $.get(`${API_BASE_URL}/student`, function(allStudents) {
                    const courseStudents = data.map(sc => {
                        const studentInfo = allStudents.find(s => s.sno === sc.sno) || {};
                        return { ...sc, sname: studentInfo.sname || '未知学生' };
                    });

                    const tbody = $('#courseStudentsToDeleteTableBody');
                    tbody.empty();
                    courseStudents.forEach(student => {
                        tbody.append(`
                            <tr>
                                <td>${student.sno}</td>
                                <td>${student.sname}</td>
                                <td>${student.grade}</td>
                            </tr>`);
                    });
                    $('#courseCnoToDelete').val(cno);
                    new bootstrap.Modal(document.getElementById('deleteCourseConfirmModal')).show();
                });
            } else {
                if(confirm('确定要删除这个课程吗？')) {
                    executeDeleteCourse(cno);
                }
            }
        }).fail(function() {
            if(confirm('确定要删除这个课程吗？')) {
                executeDeleteCourse(cno);
            }
        });
    }

    // 执行删除课程操作
    function executeDeleteCourse(cno) {
        if (!cno) cno = $('#courseCnoToDelete').val();

        $.ajax({
            url: `${API_BASE_URL}/sc/course/${cno}`,
            type: 'DELETE',
            success: function() {
                $.ajax({
                    url: `${API_BASE_URL}/course/${cno}`,
                    type: 'DELETE',
                    success: function() {
                        const modalElement = document.getElementById('deleteCourseConfirmModal');
                        const modal = bootstrap.Modal.getInstance(modalElement);
                        if (modal) modal.hide();
                        loadCourses();
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert('删除课程失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
                    }
                });
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('删除课程选课记录失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
            }
        });
    }

    // 删除选课
    function deleteSC(sno, cno) {
        if (confirm('确定要删除这个选课记录吗？')) {
            $.ajax({
                url: `${API_BASE_URL}/sc/${sno}/${cno}`,
                type: 'DELETE',
                success: function() {
                    alert('删除选课记录成功！');
                    loadSCs();
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    alert('删除选课记录失败：' + (jqXHR.responseJSON ? jqXHR.responseJSON.message : errorThrown));
                }
            });
        }
    }
</script>
</body>
</html>
